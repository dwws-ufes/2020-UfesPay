<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:p="http://primefaces.org/ui"
    xmlns:adm="http://github.com/adminfaces"
    template="/WEB-INF/templates/template.xhtml">


<ui:define name="title">
    <h:outputText value="#{msgs['title.home']}" />
</ui:define>

<ui:define name="description">
    <h:outputText value="#{msgs['title.home.description']}" />
</ui:define>

<ui:define name="body">

<p:card>
	<p:panel header="#{userController.userName}" align="center">
		<h:form id="form-wallet">
			<p><h:outputText align="center" value="#{msgs['text.currentAmount']}" /> <h:outputText align="center" value="#{userController.userName}" /></p>
			<p>
				<p:inputNumber id="new_ballance" symbol="#{msgs['text.currencySymbol']}" symbolPosition="s" decimalSeparator="." thousandSeparator="," />
				<p:commandButton type="button" value="#{msgs['text.walletAddBalance']}" styleClass="rounded-button" >
					<p:resetInput target=":form-transaction:create-transaction-content"/>
				</p:commandButton>
			</p>
		</h:form>
	</p:panel>
    
    <p:divider />
    
    <h:form id="form-transaction">
		<p:toolbar>
            <p:toolbarGroup align="center">
                <p:commandButton value="#{msgs['text.newTransaction']}" icon="pi pi-plus" 
                                 styleClass="ui-button-success" style="margin-right: .5rem"  action="#{transactionController.openNewTransaction}" 
                                 oncomplete="PF('createTransactionDialog').show()"/>
            </p:toolbarGroup>
        </p:toolbar>
        <p:dataTable id="dt-transactions" widgetVar="dtTransactions" var="transaction" value="#{transactionController.transactions}"
                     reflow="true" styleClass="products-table"
                     rowKey="#{transaction.id}" paginator="true"
                     rows="10" rowSelectMode="add" paginatorPosition="bottom" selectionMode="single"  selection="#{transactionController.selectedTransaction}">
            <f:facet name="header">
                <div class="products-table-header">
                    <span style="font-weight: bold"><h:outputText align="center" value="#{msgs['text.transactionDataTableHeader']}" /></span>
                    <span class="filter-container ui-input-icon-left">
                        <i class="pi pi-search"></i>
                        <p:inputText id="globalFilter" onkeyup="PF('dtTransactions').filter()" placeholder="Search"/>
                    </span>
                </div>
            </f:facet>
            	<p:column headerText="#{msgs['text.transactionDataTableEmitter']}" sortBy="#{transaction.emitter.name}" filterBy="#{transaction.emitter.name}">
                	<h:outputText value="#{transaction.emitter.name}"/>
            	</p:column>
				<p:column headerText="#{msgs['text.transactionDataTableReceiver']}" sortBy="#{transaction.receiver.name}" filterBy="#{transaction.receiver.name}">
                	<h:outputText value="#{transaction.receiver.name}"/>
            	</p:column>
				<p:column headerText="#{msgs['text.transactionDataTableValue']}" sortBy="#{transaction.value}">
                	<h:outputText value="#{transaction.value}" style="font-weight: 700">
                    <f:convertNumber currencySymbol="#{msgs['text.currencySymbol']}" type="currency"/>
	                </h:outputText>
    	        </p:column>   
				<p:column headerText="#{msgs['text.transactionDataTableDate']}" sortBy="#{transaction.created_at}">
					<h:outputText value="#{transaction.created_at}"/>
            	</p:column>   
				<p:column exportable="false">
                <p:commandButton icon="pi pi-pencil" update=":form-transaction:manage-transaction-content"
                                 oncomplete="PF('manageTransactionDialog').show()"
                                 styleClass="edit-button rounded-button ui-button-success" process="@this">
                    <f:setPropertyActionListener value="#{transaction}" target="#{transactionController.selectedTransaction}"/>
                    <p:resetInput target=":form-transaction:manage-transaction-content"/>
                </p:commandButton>
            </p:column>
        </p:dataTable>
        
        	<p:dialog header="#{msgs['text.transactionEditHeader']}" showEffect="fade" modal="true" widgetVar="manageTransactionDialog" responsive="true">
            	<p:outputPanel id="manage-transaction-content" class="ui-fluid">
            		<p:outputPanel rendered="#{not empty transactionController.selectedTransaction}">
	            		<div class="p-field">
	                        <p:outputLabel for="emitterName" value="#{msgs['text.transactionDataTableEmitter']}" />
	                        <p:inputText id="emitterName" value="#{transactionController.selectedTransaction.emitter.name}" readonly="true"/>
	                    </div>
						<div class="p-field">
	                        <p:outputLabel for="receiverName" value="#{msgs['text.transactionDataTableReceiver']}"/>
	                        <p:inputText id="receiverName" value="#{transactionController.selectedTransaction.receiver.name}" readonly="true"/>
	                    </div>
						<div class="p-field">
	                        <p:outputLabel for="transacValue" value="#{msgs['text.transactionDataTableReceiver']}"/>
							<p:inputNumber id="transacValue" value="#{transactionController.selectedTransaction.value}"
                                           symbol="#{msgs['text.currencySymbol']}" symbolPosition="p"
                                           decimalSeparator="," thousandSeparator="." readonly="true"/>
	                    </div>
            		</p:outputPanel>	
            	</p:outputPanel>
                <f:facet name="footer">
                <p:commandButton value="Save" icon="pi pi-check" actionListener="#{transactionController.updateTransaction}"
                                 update="manage-transaction-content" process="manage-transaction-content @this" oncomplete="PF('manageTransactionDialog').hide()"/>
                <p:commandButton value="Cancel" icon="pi pi-times" onclick="PF('manageTransactionDialog').hide()"
                                 class="ui-button-secondary"/>
            </f:facet>
        	</p:dialog>

			<p:dialog header="#{msgs['text.transactionEditHeader']}" showEffect="fade" modal="true" widgetVar="createTransactionDialog" responsive="true">
            	<p:outputPanel id="create-transaction-content" class="ui-fluid">
            	</p:outputPanel>
                <f:facet name="footer">
                <p:commandButton value="Save" icon="pi pi-check" actionListener="#{transactionController.createTransaction}"
                                 update="create-transaction-content" process="create-transaction-content @this" oncomplete="PF('createTransactionDialog').hide()"/>
                <p:commandButton value="Cancel" icon="pi pi-times" onclick="PF('createTransactionDialog').hide()"
                                 class="ui-button-secondary"/>
				</f:facet>
        	</p:dialog>


        
        
      </h:form>
</p:card>


	<p><h:outputText value="#{msgs['text.home.about01']}" /></p>
	<p><h:outputText value="#{msgs['text.home.about02']}" escape="false" /></p>
</ui:define>

</ui:composition>