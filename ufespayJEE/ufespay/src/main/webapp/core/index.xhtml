<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:p="http://primefaces.org/ui"
    xmlns:adm="http://github.com/adminfaces"
   template="/WEB-INF/templates/templateLogin.xhtml">

<!-- "/WEB-INF/templates/template.xhtml"> -->
<f:metadata>
     <f:event type="preRenderView" listener="#{transactionController.retriedAllTransactions()}" />
</f:metadata>

<ui:define name="title">
    <h:outputText value="#{msgs['title.home']}" />
</ui:define>

<ui:define name="description">
    <h:outputText value="#{msgs['title.home.description']}" />
</ui:define>

<ui:define name="body">

<p:card>
	<h:form id="form-wallet">
		
		<p:messages id="messages" showDetail="true" closable="true">
            <p:autoUpdate/>
        </p:messages>
        

		<p:panel header="#{loginUserController.currentUser.name}" style="display:block; text-align:center">
			 <p:avatar icon="pi pi-user" styleClass="p-mr-2" size="xlarge" style="background-color:#2196F3; color: #ffffff" shape="circle" /> <br/>
			 
			 	<p:commandButton value="#{msgs['text.logout']}" 
			 	style="text-align:center"
			 	styleClass="rounded-button ui-button-secondary" action="#{loginUserController.logout}" update="@form"/>	 <br/>
			 	
			 	<p:commandButton value="#{msgs['text.home.linkeddata.featues']}" 
			 		style="float: right"
			 		styleClass="rounded-button ui-button-secondary" action="#{transactionController.redirectsLinkedData}" update="@form"/>	 <br/>
			 
			 <h:outputText align="center" value="#{msgs['text.currentAmount']}" />  <br/>
			 
			 <h:outputText align="center" value="#{userController.currentAmountBalance}" > 
			 	<f:convertNumber currencySymbol="#{msgs['text.currencySymbol']}" type="currency" maxFractionDigits="2" locale="#{loginUserController.userLocale}"/>
			 </h:outputText>
			 
			 <br/>
			   
				<p:inputNumber id="new_ballance" symbol="#{msgs['text.currencySymbol']}" 
												value="#{userController.addNewAmountBalance}" symbolPosition="p" decimalSeparator="," thousandSeparator="." 
												emptyValue="zero"/>
												
				 <p:commandButton value="#{msgs['text.walletAddBalance']}" icon="pi pi-plus" 
                                 styleClass="ui-button-success" action="#{userController.addWalletAmount}" update="@form"/>      								
		</p:panel>
		
    </h:form>
    
    
    <p:divider />
    
    <h:form id="form-transaction">
		<p:toolbar>
            <p:toolbarGroup align="center">
                <p:commandButton value="#{msgs['text.newTransaction']}" icon="pi pi-plus"
                                 styleClass="ui-button-success" style="margin-right: .5rem"  
                                 actionListener="#{transactionController.openNewTransaction}">       
                 </p:commandButton>
            </p:toolbarGroup>
        </p:toolbar>
        <p:dataTable id="dt-transactions" widgetVar="dtTransactions" var="transaction" value="#{transactionController.transactions}"
                     reflow="true" styleClass="products-table"
                     rowKey="#{transaction.id}" paginator="true"
                     rows="10" rowSelectMode="add" paginatorPosition="bottom" selectionMode="single"  selection="#{transactionController.selectedTransaction}">
            <f:facet name="header">
                <div class="products-table-header">
                    <span style="font-weight: bold"><h:outputText align="center" value="#{msgs['text.transactionDataTableHeader']}" /></span>
                    <span class="filter-container ui-input-icon-left">
                        <i class="pi pi-search"></i>
                        <p:inputText id="globalFilter" onkeyup="PF('dtTransactions').filter()" placeholder="Search"/>
                    </span>
                </div>
            </f:facet>
            	<p:column headerText="#{msgs['text.transactionDataTableEmitter']}" sortBy="#{transaction.emitter.name}" filterBy="#{transaction.emitter.name}">
                	<h:outputText value="#{transaction.emitter.name}"/>
            	</p:column>
				<p:column headerText="#{msgs['text.transactionDataTableReceiver']}" sortBy="#{transaction.receiver.name}" filterBy="#{transaction.receiver.name}">
                	<h:outputText value="#{transaction.receiver.name}"/>
            	</p:column>
				<p:column headerText="#{msgs['text.transactionDataTableValue']}" sortBy="#{transaction.value}">
                	<h:outputText value="#{transaction.value}" style="font-weight: 700">
                    <f:convertNumber currencySymbol="#{msgs['text.currencySymbol']}" type="currency" maxFractionDigits="2" locale="#{loginUserController.userLocale}"/>
	                </h:outputText>
    	        </p:column>   
				<p:column headerText="#{msgs['text.transactionDataTableDate']}" sortBy="#{transaction.created_at}">
					<h:outputText value="#{transaction.created_at}"/>
            	</p:column>   
				<p:column exportable="false">
                <p:commandButton icon="pi pi-pencil" 
                				 styleClass="edit-button rounded-button ui-button-success" 
                				 action= "#{transactionController.prepareUpdateTransac}">
                    <f:setPropertyActionListener value="#{transaction}" target="#{transactionController.selectedTransaction}"/>
                </p:commandButton>
            </p:column>
        </p:dataTable>        
      </h:form>
</p:card>
</ui:define>
<ui:define name="footer">
		<p><h:outputText value="#{msgs['text.home.about02']}" escape="false" /></p>
		<h:outputText value="#{msgs['text.developedBy']}" escape="false" />
		<div class="pull-right hidden-xs" style="color: gray">
			<i>1.0.0</i>
		</div>
</ui:define>
</ui:composition>