<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:adm="http://github.com/adminfaces"
	template="/WEB-INF/templates/templateLogin.xhtml">

<ui:define name="title">
    <h:outputText value="#{msgs['title.home']}" />
</ui:define>

<ui:define name="description">
    <h:outputText value="#{msgs['title.home.description']}" />
</ui:define>

	<ui:define name="body">
	<h:form id="form-newTransaction">
		<div class="card">
				<p:messages id="messages" showDetail="true">
					<p:autoUpdate />
				</p:messages>	
		        <p:outputPanel id="manage-transaction-content" class="ui-fluid">
            		<p:outputPanel rendered="#{not empty transactionController.selectedTransaction}">
	            		<div class="p-field">
	                        <p:outputLabel for="emitterName" value="#{msgs['text.updateTransaction.emitter']}" />
	                        <p:inputText id="emitterName" value="#{transactionController.selectedTransaction.emitter.name}" readonly="true"/>
	                    </div>
						<div class="p-field">
	                        <p:outputLabel for="receiverName" value="#{msgs['text.updateTransaction.receiver']}"/>
	                        <p:inputText id="receiverName" value="#{transactionController.selectedTransaction.receiver.name}" readonly="true"/>
	                    </div>
						<div class="p-field">
	                        <p:outputLabel for="transacValue" value="#{msgs['text.updateTransaction.value']}"/>
								<h:outputText id="transacValue" value="#{transactionController.selectedTransaction.value}" > 
			 						<f:convertNumber currencySymbol="#{msgs['text.currencySymbol']}" type="currency" maxFractionDigits="2" locale="#{loginUserController.userLocale}"/>
			 					</h:outputText>
	                    </div>
						<div class="p-field">
	                        <p:outputLabel for="transacDateCreate" value="#{msgs['text.updateTransaction.createDt']}"/>
							<h:outputText id="transacDateCreate"  value="#{transactionController.selectedTransaction.created_at}"/>
	                    </div>        
            		</p:outputPanel>	
            	</p:outputPanel>
            	
            	<p:divider />
            	<p:card id="likeTransacCard" class="ui-fluid">
					<p:outputLabel for="likePanel" value="#{msgs['text.updateTransaction.likeDataText']}"/>
					<p:outputPanel id="likePanel" class="ui-fluid">
           				<p:commandButton for ="likeTransacCard" icon="pi pi-heart"
           						 style="background-color:pink" 
                                 styleClass="rounded-button ui-button-help ui-button-outlined" 
                                 action="#{transactionController.toggleLike}" 
                                 rendered="#{transactionController.selectedTransaction.isLikedByUser(loginUserController.currentUser)}"
                                 update="@parent"/>      	

           				<p:commandButton for ="likeTransacCard" icon="pi pi-heart" 
                                 styleClass="rounded-button ui-button-help ui-button-outlined" 
                                 style="background-color:transparent"
                                 action="#{transactionController.toggleLike}" 
                                 rendered="#{not transactionController.selectedTransaction.isLikedByUser(loginUserController.currentUser)}"
                                 update="@parent"/>      	
            		</p:outputPanel>  
            		

            	</p:card>	          	

            	<p:divider />
            	<p:divider />
            	
            	<p:card id="addCommentCard" class="ui-fluid">
         				   	<p:inputText id="commentText" value="#{transactionController.newComment.text}" maxlength="140"/>
            				<p:commandButton for ="commentText" value="#{msgs['text.updateTransaction.addComment']}" icon="pi pi-plus" 
                                 styleClass="ui-button-success" action="#{transactionController.addCommentTransac}" update="@form"/>      	
            	</p:card>
            	
            	<p:divider />
            	
				<p:card id="transactionComments" class="ui-fluid">
					        <p:dataTable id="dt-comments" widgetVar="dtComments" var="currentComment" 
					        				value="#{transactionController.selectedTransaction.comments}"
                     						reflow="true" styleClass="products-table"
                     						rowKey="#{currentComment.id}" paginator="true"
                     						rows="10" rowSelectMode="add" 
                     						paginatorPosition="bottom" 
                     						selectionMode="single" 
                     						disabledSelection="true">
                     						
                     			<f:facet name="header">
                     				<div class="products-table-header">
                    					<span style="font-weight: bold">
                    						<h:outputText align="center" 
                    					                  value="#{msgs['text.updateTransaction.commentDataHeader']}" />
                    					</span>
                    					<span class="filter-container ui-input-icon-left">
                        				<i class="pi pi-search"></i>
                        					<p:inputText id="globalFilter" onkeyup="PF('dtComments').filter()" placeholder="Search"/>
                    					</span>
                					</div>
            					</f:facet>
            					
								<p:column headerText="#{msgs['text.updateTransaction.commentDataAuthor']}" 
											sortBy="#{currentComment.author.name}" 
											filterBy="#{currentComment.author.name}">
                							<h:outputText value="#{currentComment.author.name}"/>
            					</p:column>
            					
            					<p:column headerText="#{msgs['text.updateTransaction.commentDataText']}" 
											sortBy="#{currentComment.text}" 
											filterBy="#{currentComment.text}">
                							<h:outputText value="#{currentComment.text}"/>
            					</p:column>
								<p:column exportable="false">
                					<p:commandButton class="ui-button-warning rounded-button" icon="pi pi-trash"
                				 		action= "#{transactionController.deleteCommentTransac}"
                				 		rendered="#{currentComment.author.email.equalsIgnoreCase(loginUserController.currentUser.email)}">
                    					<f:setPropertyActionListener value="#{currentComment}" target="#{transactionController.selectedComment}"/>
                					</p:commandButton>
            					</p:column>
                	</p:dataTable> 				
            	</p:card>
            	            	
            	<p:divider />
                						
                <p:commandButton value="#{msgs['text.newTransaction.cancel']}"  icon="pi pi-times" 
                				 action="#{transactionController.redirectsHome}"
                                 class="ui-button-secondary"/>
			</div>
		</h:form>
	</ui:define>
	
	<ui:define name="footer">
		<p><h:outputText value="#{msgs['text.home.about02']}" escape="false" /></p>
		<h:outputText value="#{msgs['text.developedBy']}" escape="false" />
		<div class="pull-right hidden-xs" style="color: gray">
			<i>1.0.0</i>
		</div>
	</ui:define>
</ui:composition>

